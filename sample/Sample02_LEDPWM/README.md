# サンプル02 LED PWM
---

## 概要
今回も前回に引き続きLED点灯回路について説明します。
前回はLEDのオン・オフについて学びましたが、出力を制御する時2値ではなくもっと細かく制御したい時があります。例えばLEDの場合だとオンの時の半分の明るさなどにしたい時もあるでしょう。
これは電力と比例するので単純に考えると電流制限抵抗の値を変えればいいのですが(電圧は固定なので)、抵抗値は決まっているために変更できません。それではどのように出力を制御するかといいいますと今回のPWMです。

## 回路説明
前回Arduinoは一つのピンに多くの機能が割り当てられていると説明しましたが、今回使用するPWMという機能は使えるピンが限られています。3、5、6、9、10、11番のピンが該当します。
この内BeginnerShieldでLEDに割り当てられているのは緑のLEDとフルカラーLEDです。
今回はこの内緑のLED駆動回路を使用します。回路図自体は前回と同じです。

## プログラム説明
まず、PWMがどのようなものか説明します。
最初に述べたようにArduinoの出力はデジタルで0Vか5Vしか出力することができません。そこで出力を高速でオンオフを切り替えることで擬似的にアナログ値を実現します。
サンプル1のようにLEDは点滅することになりますが、あまりに速いために人間の目には残像効果として点灯しているようにみえます。そしてその明かりの強さはオンとオフの長さで決まります。
オンオフの連続をグラフに書くとカクカクした波形になりますがこれを矩形波(パルス)と呼び、オンオフの長さの比をデューティ比と呼びます。  
ArduinoではPWMを自前で処理しなくても使用できる関数があります。  
それがanalogWrite関数です。
analogWrite関数の第一引数にはピン番号、第二引数には明るさを示す値が入ります。明るさの範囲は0~255の間で入力します。
次のように記述します。
```C
#define LED_PIN 3

void setup(){
   pinMode(LED_PIN, OUTPUT);
}

void loop(){
   analogWrite(3, 128);
}
```
このように記述することでdigitalWriteでLEDを点灯した時より半分(256の半分なので)の明るさで点灯します。  
サンプルプログラムとして[Sample02_LChika.ino](Sample02_LChika.ino)を置きます。このサンプルでは10msごとにLEDの明るさが変化し約2.5秒で明るさが最大になり、その後また最弱まで変化します。
